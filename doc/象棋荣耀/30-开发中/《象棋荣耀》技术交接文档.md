# **《象棋荣耀》技术交接文档**

### **文档简介**

本文档旨在为《象棋荣耀》项目的所有开发人员提供一个清晰、统一的技术参考。它将随着项目的开发进度持续更新，记录核心架构设计、模块功能、代码规范和重要工作流程。请新加入的成员务必首先详细阅读此文档。

---

## **第一部分：项目文件夹结构总览**

项目的Assets目录采用分层结构，旨在实现关注点分离（Separation of Concerns），确保代码、资源和配置文件的组织清晰。

- **/Assets/Scenes/**
    
    - **用途**: 存放所有游戏场景文件 (.unity)。例如 InitScene, MainMenuScene, BattleScene 等。
        
- **/Assets/Scripts/**
    
    - **用途**: 存放所有C#脚本。这是项目逻辑的核心。
        
    - **/Scripts/_Core/**: **核心框架层**。存放与游戏具体玩法完全无关、高度可复用的底层代码。
        
        - /Foundation/: 基础工具集，如单例模式、常量定义等。
            
        - /Data/: 核心数据结构，如棋子、玩家信息的纯数据定义。
            
    - **/Scripts/_Gameplay/**: **游戏玩法层**。存放实现游戏核心玩法的代码，如回合制逻辑、实时制逻辑、技能系统等。（**此阶段为空，后续添加**）
        
    - **/Scripts/_App/**: **应用与表现层**。存放与游戏表现和应用流程相关的代码，如UI管理器、场景加载器、音效管理器等。（**此阶段为空，后续添加**）
        
- **/Assets/Art/**
    
    - **用途**: 存放所有美术资源，包括模型、材质、贴图、特效等。
        
- **/Assets/Audio/**
    
    - **用途**: 存放所有音频资源，包括背景音乐（BGM）和音效（SFX）。
        
- **/Assets/Prefabs/**
    
    - **用途**: 存放所有预制体（Prefabs），如棋子模型、UI窗口、特效等。
        
- **/Assets/_Content/**
    
    - **用途**: **策划配置内容**。存放所有使用ScriptableObject创建的游戏配置文件。这是策划调整游戏数值和内容的主要工作区。
        
        - /GameConfig/: 存放游戏的核心配置，如平衡性数值、武将定义、技能定义等。
            

---

## **第二部分：核心脚本文件概览 (A-1.1)**

以下是当前阶段已创建的核心脚本及其职责说明。

### **模块: _Core/Foundation (基础工具)**

|   |   |   |
|---|---|---|
|文件名|路径|核心职责|
|Singleton.cs|/Scripts/_Core/Foundation/|提供一个线程安全的MonoBehaviour单例模式基类。|
|PersistentSingleton.cs|/Scripts/_Core/Foundation/|继承自Singleton，提供跨场景不销毁的全局单例功能。|
|GameConstants.cs|/Scripts/_Core/Foundation/|静态类，用于集中管理游戏中的所有硬编码常量（“魔法数字”）。|

### **模块: _Core/Data (核心数据)**

|   |   |   |
|---|---|---|
|文件名|路径|核心职责|
|DataEnums.cs|/Scripts/_Core/Data/|定义游戏中所有核心的枚举类型，如阵营(PlayerTeam)、棋子类型(PieceType)、棋子状态(PieceStatus)。|
|GameData.cs|/Scripts/_Core/Data/|定义游戏中核心的纯数据结构，包括PieceData（棋子数据）、PlayerProfile（玩家档案）和GameSetupData（对局配置）。|

### **模块: _Content/GameConfig (策划配置)**

|   |   |   |
|---|---|---|
|文件名|路径|核心职责|
|GameBalanceConfig.cs|/Scripts/_Content/GameConfig/|ScriptableObject类，用于定义游戏的核心平衡数值（如行动点、移速）。|
|HeroConfig.cs|/Scripts/_Content/GameConfig/|ScriptableObject类，用于定义一个武将的所有静态数据（如ID、名称、可绑定棋子类型）。|
|SkillConfig.cs|/Scripts/_Content/GameConfig/|ScriptableObject类，用于定义一个技能的所有静态数据（如ID、冷却时间）。|

---

## **第三部分：核心模块设计详解**

### **3.1 模块: Core.Foundation - 基础工具集**

- **设计思想**: 提供全项目通用的基础代码，避免重复造轮子，是代码复用和项目健壮性的基石。
    
- **Singleton<T> / PersistentSingleton<T>**:
    
    - **用途**: 用于创建全局唯一的管理器实例，如 AudioManager.Instance。
        
    - **使用方法**: 让你的管理器类（例如 public class AudioManager : PersistentSingleton<AudioManager>）继承它即可，无需编写任何单例逻辑。
        
    - **注意**: PersistentSingleton用于需要跨场景存在的管理器，如游戏总管理器、音效管理器。普通Singleton用于仅在当前场景有效的管理器。
        

### **3.2 模块: Core.Data - 核心数据结构**

- **设计思想**: **逻辑与表现分离**。此模块下的所有代码都是**纯数据**（Plain Old C# Object/Struct），不继承MonoBehaviour，不包含任何Unity场景逻辑。这使得数据易于序列化（用于网络传输和存档）、易于测试，并且是构建后续游戏状态机（GameState）的基础。
    
- **PieceStatus 枚举**:
    
    - **关键技术**: 使用了 [Flags] 特性，允许一个棋子同时拥有多个状态。
        
    - **原理**: 每个枚举值都是2的幂（1 << n），其二进制表示中只有一个位是1。通过**位运算**（| 或 &）可以高效地组合和检查状态。
        
    - **示例**:
        
        - 设置状态: status = PieceStatus.IsMoving | PieceStatus.IsAttacking;
            
        - 检查状态: if ((status & PieceStatus.IsMoving) != 0) { ... }
            
        - 添加状态: status |= PieceStatus.Stunned;
            
        - 移除状态: status &= ~PieceStatus.Stunned;
            
- **PieceData 结构体**:
    
    - **核心定位**: 它是游戏中一个棋子的**唯一数据快照**。游戏世界中所有棋子的状态，都可以通过一个List<PieceData>来完整描述。
        
    - **uniqueId**: 这是至关重要的字段。由于场上可以有多个同类型棋子（如2个“车”），uniqueId是区分它们的唯一标识符，将在网络同步和技能目标选择中扮演关键角色。
        

### **3.3 模块: ScriptableObject 配置系统 (_Content/)**

- **设计思想**: **将游戏设计与程序实现解耦**。策划人员可以直接在Unity Editor中创建和修改.asset配置文件，而无需修改任何代码，极大地提高了开发效率和安全性。
    
- **工作流程**:
    
    1. **程序员**: 编写一个继承自 ScriptableObject 的配置类（如 HeroConfig.cs），并添加 [CreateAssetMenu] 特性。
        
    2. **策划/设计师**: 在Unity的 Assets 目录中，通过右键菜单 (ChessHonor/Configs/...) 创建该配置的实例文件（.asset）。
        
    3. **策划/设计师**: 选中.asset文件，在Inspector面板中填写所有暴露出的公共字段。
        
    4. **程序员**: 在代码中通过一个管理器加载这些.asset文件，并在游戏运行时读取其中的数据。
        
- **优势**:
    
    - **对设计师友好**: 直观的图形化编辑界面。
        
    - **版本控制友好**: .asset文件是Unity的原生资源，易于Git等工具管理。
        
    - **性能**: ScriptableObject在加载后会驻留内存，读取速度快，避免了运行时的文件解析开销（如JSON）。