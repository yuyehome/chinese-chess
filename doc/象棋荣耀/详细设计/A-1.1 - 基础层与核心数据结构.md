### **详细设计文档: A-1.1 - 基础层与核心数据结构**

**文档版本**: 1.0  
**设计目标**: 定义游戏中所有通用的、与具体玩法无关的核心数据结构和基础工具，为所有上层模块提供稳定、统一、可扩展的数据模型和底层支持。

---

### **模块 1: Core.Foundation - 基础工具集**

#### **1.1. 模块目标 (Goal)**

提供全项目通用的基础脚本和工具类，避免重复造轮子，确保代码风格和基础功能统一。

#### **1.2. 模块内容与技术方案 (Code Design & Tech Plan)**

- **代码路径**: Assets/_Core/Foundation/
    
- **类设计**:
    
    1. **Singleton<T>**
        
        - **类型**: 抽象泛型类 (public abstract class Singleton<T> where T : MonoBehaviour)
            
        - **职责**: 提供一个线程安全的MonoBehaviour单例模式基类，所有管理器类（如LocalizationManager, AudioManager）都将继承自它。
            
        - **关键成员**:
            
            - public static T Instance { get; }: 公共静态访问属性，负责查找或创建唯一的实例。
                
    2. **PersistentSingleton<T>**
        
        - **类型**: 抽象泛型类 (继承自 Singleton<T>)
            
        - **职责**: 在Singleton<T>的基础上，增加跨场景不销毁的功能。
            
        - **逻辑**: 在Awake()方法中调用DontDestroyOnLoad(this.gameObject)。
            
    3. **GameConstants**
        
        - **类型**: 静态类 (public static class GameConstants)
            
        - **职责**: 存放游戏全局硬编码常量，便于集中管理和修改。
            
        - **关键成员**:
            
            - public const int BOARD_WIDTH = 9;
                
            - public const int BOARD_HEIGHT = 10;
                
            - public const float ACTION_POINT_RECOVERY_RATE = 3.0f; (每3秒恢复1点)
                

---

### **模块 2: Core.Data - 核心数据结构**

#### **2.1. 模块目标 (Goal)**

定义游戏世界的核心实体数据结构。这些结构必须是纯数据（不含MonoBehaviour），易于序列化（用于网络传输和存储），并能清晰地描述游戏世界的任何一个状态。

#### **2.2. 模块内容与技术方案 (Code Design & Tech Plan)**

- **代码路径**: Assets/_Core/Data/
    
- **枚举设计**:
    
    1. **PlayerTeam** (enum): 定义玩家阵营。{ Red, Black }
        
    2. **PieceType** (enum): 定义所有棋子类型。{ General, Advisor, Elephant, Horse, Chariot, Cannon, Soldier }
        
    3. **PieceState** (enum): 定义棋子的所有可能状态。{ Idle, Moving, Flying, Dead, Stunned }
        
- **类/结构设计**:
    
    1. **PieceData**
        
        - **类型**: struct 或 class (为FishNet序列化方便，通常用struct，并且需要实现INetworkSerializable)
            
        - **职责**: **游戏中所有棋子的唯一数据表示**。它描述了一个棋子在**某一时刻**的所有属性。
            
        - **关键成员**:
            
            - public int uniqueId;: **全局唯一ID**。由服务器（或主机）在棋子生成时（包括开局和召唤）分配的一个自增整数。解决了扩展性问题。
                
            - public PlayerTeam team;: 棋子归属的阵营。
                
            - public PieceType type;: 棋子的兵种。
                
            - public Vector2Int position;: 棋子在棋盘网格上的逻辑坐标。
                
            - public PieceState state;: 棋子当前的状态。
                
            - public int heroId;: 附身在该棋子上的武将ID（如果没有则为-1）。
                
    2. **PlayerProfile**
        
        - **类型**: class
            
        - **职责**: 定义玩家的**持久化数据**，跨对局存在。
            
        - **关键成员**:
            
            - public ulong steamId;: 玩家的唯一标识。
                
            - public string nickname;
                
            - public int eloRating; (段位分数)
                
            - public long goldCoins; (金币)
                
            - public List<int> unlockedHeroIds;: 已解锁的武将ID列表。
                
            - public List<int> unlockedSkinIds;: 已解锁的皮肤ID列表。
                
    3. **GameSetupData**
        
        - **类型**: class
            
        - **职责**: 描述一局**对局开始前的配置信息**。
            
        - **关键成员**:
            
            - public PlayerProfile redPlayer;
                
            - public PlayerProfile blackPlayer;
                
            - public List<InitialPieceSetup> initialPieceSetups;: 定义了开局所有棋子的初始布局和武将绑定。
                
    4. **InitialPieceSetup** (作为GameSetupData的子结构)
        
        - **类型**: struct
            
        - **职责**: 定义单个棋子的初始配置。
            
        - **关键成员**:
            
            - public PieceType type;
                
            - public Vector2Int initialPosition;
                
            - public PlayerTeam team;
                
            - public int heroId; (绑定的武将ID，-1表示无)
                
    5. **ScriptableObject 配置类**:
        
        - **职责**: 使用Unity的ScriptableObject作为策划配置游戏数值和静态数据的工具。
            
        - **路径**: Assets/_Content/GameConfig/
            
        - **具体类**:
            
            - GameBalanceConfig.cs:
                
                - public float actionPointMax;
                    
                - public float pieceMoveSpeed;
                    
                - // ... 其他游戏平衡相关的数值
                    
            - HeroConfig.cs:
                
                - public int heroId;
                    
                - public string heroNameKey; (用于本地化的Key)
                    
                - public string heroDescriptionKey;
                    
                - public PieceType allowedPieceType; (该武将能绑定的棋子类型)
                    
                - public SkillConfig skill;
                    
            - SkillConfig.cs:
                
                - public int skillId;
                    
                - public string skillNameKey;
                    
                - public float cooldown;
                    
                - // ... 其他技能参数，如范围、伤害等
                    

#### **2.3. Unity工作流 (Unity Workflow)**

1. **创建ScriptableObject配置**:
    
    - 在Assets/_Content/GameConfig/目录下，右键 Create -> ChessHonor -> Configs -> GameBalanceConfig，创建一个名为DefaultBalance的配置文件。在Inspector中填写最大行动点、棋子移速等数值。
        
    - 为游戏中的每一个武将，创建一个HeroConfig实例，并配置其ID、名称、描述、可绑定兵种以及其拥有的SkillConfig。
        
2. **代码中的使用**:
    
    - 一个ConfigManager（单例）将负责在游戏启动时加载这些ScriptableObject，并提供给其他系统访问。
        
    - 例如，当需要查询一个武将的信息时，调用 ConfigManager.Instance.GetHeroConfig(heroId)。
        
    - 当游戏逻辑需要棋子移动速度时，访问 ConfigManager.Instance.GameBalance.pieceMoveSpeed。